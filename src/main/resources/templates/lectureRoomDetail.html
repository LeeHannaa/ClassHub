<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>ClassHub</title>

    <!-- Custom fonts for this template-->
    <link th:href="@{/bootstrap/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link th:href="@{/bootstrap/css/sb-admin-2.min.css}" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .fixed-bottom-right {
            position: fixed;
            top: 100px;
            right: 70px;
        }

        .card {
            width: 100%;
            margin: auto;
        }
        .fixed-paginator {
            position: fixed;
            bottom: 20px;
            left: 55%;
            z-index: 9999;
        }
    </style>
    <script src="/ClassHub/bootstrap/vendor/jquery/jquery.min.js"></script>
    <script src="/ClassHub/bootstrap/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="/ClassHub/bootstrap/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/ClassHub/bootstrap/js/sb-admin-2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#openModalButton').click(function(event) {
                event.preventDefault();
                submitPostFormAndLoadModal();
            });

            $('#createPostButton').click(function() {
                let lRoomId = $(this).data('lroom-id');
                $('#modalLRoomId').val(lRoomId);
                $('#CreatePostModal').modal('show');
            });
        });
    </script>
</head>
<script>
    function copyCode(codeId) {
        // span 요소에서 텍스트를 가져옵니다.
        var code = document.getElementById(codeId).textContent;
        // 텍스트를 클립보드에 복사합니다.
        navigator.clipboard.writeText(code)
            .then(function() {
                alert('코드가 성공적으로 복사되었습니다: ' + code);
            })
            .catch(function(err) {
                alert('코드 복사 중 오류가 발생했습니다. 수동으로 복사해주세요.');
            });
    }
</script>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/ClassHub/lecture-room">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">ClassHub <sup style="font-size: 10px">hgu</sup></div>
        </a>

        <div class="sidebar-heading" th:object="${lectureRoom}">
          <span for="name" th:text="${lectureRoom.roomName}"></span>
        </div>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Nav Item - Dashboard -->
        <li class="nav-item active" th:object="${lectureRoom}">
            <a class="nav-link" th:href="@{'/lecture-room/detail/' + ${lectureRoom.lectureRoomId}}">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>대시보드</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
          태그
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages" aria-expanded="true"
               aria-controls="collapsePages">
                <i class="fas fa-fw fa-folder"></i>
                <span>태그 모음</span>
            </a>
            <div id="collapsePages" class="collapse" aria-labelledby="headingPages"
                 data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <div class="input-group mb-2" style="max-width: 180px; margin: 0 auto;">
                        <input type="text" class="form-control" placeholder="태그 검색" id="tagSearchInput">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="tagSearchButton">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div id="tagList">
                        <a class="collapse-item" th:href="@{'/data-detail/statistics/' + ${tag.tagId}}" th:each="tag : ${tags}" th:text="${tag.name}"></a>
                    </div>
                </div>
            </div>
        </li>

        <script>
            document.getElementById("tagSearchButton").addEventListener("click", function () {
                filterTags(document.getElementById('tagSearchInput').value.toUpperCase());
            });
            document.getElementById("tagSearchInput").addEventListener("keypress", function(event) {
                if (event.key === 'Enter') {
                    filterTags(document.getElementById('tagSearchInput').value.toUpperCase());
                }
            });

            function filterTags(filter) {
                var ul, li, a, i, txtValue;
                ul = document.getElementById("tagList");
                li = ul.getElementsByTagName('a');
                for (i = 0; i < li.length; i++) {
                    txtValue = li[i].textContent || li[i].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        li[i].style.display = "";
                    } else {
                        li[i].style.display = "none";
                    }
                }
            }

            // Show all tags by default
            filterTags('');
        </script>

        <!-- Divider -->
        <hr class="sidebar-divider">
        <!-- Heading -->
        <div class="sidebar-heading">
            설정
        </div>

        <!-- Nav Item - Utilities Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
               aria-expanded="true" aria-controls="collapseUtilities">
                <i class="fas fa-fw fa-cog"></i>
                <span>설정</span>
            </a>
            <div id="collapseUtilities" class="collapse" aria-labelledby="headingUtilities"
                 data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded" th:object="${lectureRoom}">
                    <h6 class="collapse-header">수정</h6>
                    <a class="collapse-item" th:href="@{'/lecture-room/detail/info/' + ${lectureRoom.lectureRoomId}}">강의실 정보</a>
                    <a class="collapse-item" th:href="@{/lecture-room/member/info/{lectureRoomId}(lectureRoomId=${lectureRoom.lectureRoomId}, page=${0})}">강의실 구성원 정보</a>
                </div>
            </div>
        </li>

        <hr class="sidebar-divider d-none d-md-block">

          <div class="sidebar-heading">
            나의 강의실
          </div>

            <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseMyLectureRooms" aria-expanded="true" aria-controls="collapseMyLectureRooms">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
            <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139q.323-.119.684-.12h5.396z"/>
          </svg>
          <span>나의 강의실</span>
        </a>
        <div id="collapseMyLectureRooms" class="collapse" aria-labelledby="headingMyLectureRooms" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <div id="LRList">
              <div id="LRContainer" th:each="myLectureRoom : ${myLectureRooms}">
                <div class="collapse-item d-flex align-items-center justify-content-between">
                  <div class="LRNameDiv">
                    <a class="item" th:id="'LRItem_' + ${myLectureRoom.lectureRoomId}" th:href="@{${myLectureRoom.role == 'STUDENT' ? '/student/'+uniqueId : '/lecture-room/detail/'} + ${myLectureRoom.lectureRoomId}}" th:text="${myLectureRoom.roomName}" style="text-decoration: none; color: inherit;"></a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </li>


        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">

        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                <!-- Sidebar Toggle (Topbar) -->
                <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                    <i class="fa fa-bars"></i>
                </button>

                <!-- Topbar Search -->
                <form th:action="@{/lecture-room}" method="get" class="form-inline mr-auto w-100 navbar-search">
                    <div class="input-group w-50">
                        <input type="text" name="searchKeyword" th:value="${param.searchKeyword}"
                               class="form-control bg-light border-0 small"
                               placeholder="Search for..." aria-label="Search"
                               aria-describedby="basic-addon2">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search fa-sm"></i>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Topbar Navbar -->
                <ul class="navbar-nav ml-auto">
                    <!-- Nav Item - Alerts -->
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-bell fa-fw"></i>
                            <!-- Counter - Alerts -->
                            <span class="badge badge-danger badge-counter">1+</span>
                        </a>
                        <!-- Dropdown - Alerts -->
                        <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                             aria-labelledby="alertsDropdown">
                            <h6 class="dropdown-header">
                                알림
                            </h6>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="mr-3">
                                    <div class="icon-circle bg-primary">
                                        <i class="fas fa-file-alt text-white"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="small text-gray-500">May 24, 2024</div>
                                    <span class="font-weight-bold">ClassHub에 가입하신 것을 환영합니다!</span>
                                </div>
                            </a>
                            <a class="dropdown-item text-center small text-gray-500" href="#">모든 알림 보기</a>
                        </div>
                    </li>


                    <!-- Nav Item - User Information -->
                    <li class="nav-item dropdown no-arrow">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="mr-2 d-none d-lg-inline text-gray-600 small" th:text="${session.member.member_name}"></span>
                            <img class="img-profile rounded-circle"
                                 src="/ClassHub/bootstrap/img/undraw_profile.svg">
                        </a>
                        <!-- Dropdown - User Information -->
                        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                             aria-labelledby="userDropdown">
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#lectureRoomOutModal">
                                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                강의실 나가기
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                로그아웃
                            </a>
                        </div>
                    </li>

                </ul>

            </nav>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">
                <div class="container" style="width: 70%; max-width: 800px;">
                <!-- Page Heading -->
                <div th:object="${lectureRoom}">
                    <h1 class="h3 mb-4 text-gray-800" th:text="${lectureRoom.roomName}"></h1>
                </div>
                <div class="row justify-content-center">
                    <div th:each="post : ${posts}" class="col-12 mb-4">
                        <div class="card  mb-2">
                            <!-- Card Header - Dropdown -->
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary" th:text="${post.postTitle}">Dropdown Card Example</h6>
                                <div class="dropdown no-arrow">
                                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right animated--fade-in" aria-labelledby="dropdownMenuLink">
                                        <a data-toggle="modal" data-target="#PostUpdateModal" class="dropdown-item" th:postTitle="${post.postTitle}" th:postContent="${post.postContent}" th:postId="${post.id}" th:tag="${post.getTagNames()}" th:onclick="setUpdatePostId(this.getAttribute('postId'),this.getAttribute('postTitle'),this.getAttribute('postContent'),this.getAttribute('tag'))">수정</a>
                                        <a data-toggle="modal" data-target="#PostDeleteModal" class="dropdown-item" th:onclick="'setDeletePostId(\'' + ${post.id} + '\')'">삭제</a>
                                    </div>
                                </div>
                            </div>
                            <!-- Card Body -->
                            <div class="card-body">
                                <p class="card-text" th:text="${post.postContent}"></p>
                                <p class="card-text">
                                    <small class="text-muted">연결된 태그 이름:
                                        <span th:text="${post.getTagNames() != null and post.getTagNames() != '' ? post.getTagNames() : '없음'}"></span>
                                    </small>
                                </p>
                                <p class="card-text" style="text-align: right">
                                    <small class="text-muted">최근 수정일: <span th:text="${post.getModDate()}"></span></small>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li th:classappend="${currentPage == 0} ? 'disabled' : ''" class="page-item">
                                        <a class="page-link" th:href="@{/lecture-room/detail/{lectureRoomId}(lectureRoomId=${lectureRoomId}, page=${currentPage - 1})}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <li th:if="${totalPages > 0}" th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}" th:classappend="${pageNum == currentPage} ? 'active' : ''" class="page-item">
                                        <a class="page-link" th:href="@{/lecture-room/detail/{lectureRoomId}(lectureRoomId=${lectureRoomId}, page=${pageNum})}" th:text="${pageNum + 1}">1</a>
                                    </li>
                                    <li th:if="${totalPages == 0}" class="page-item active">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li th:classappend="${currentPage + 1 == totalPages} ? 'disabled' : ''" class="page-item">
                                        <a class="page-link" th:href="@{/lecture-room/detail/{lectureRoomId}(lectureRoomId=${lectureRoomId}, page=${currentPage + 1})}" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                    <button id="createPostButton" th:data-lroom-id="${lectureRoomId}" class="btn btn-success fixed-bottom-right">게시물 등록</button>
                </div>

                </div>
            </div>
        </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>ClassHub Walab B1A2 강준혁 이한나 장유진</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">로그아웃하시겠습니까?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">로그아웃 클릭 시 현재 사이트에서 로그아웃됩니다.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
                <a class="btn btn-primary" href="/ClassHub/logout">로그아웃</a>
            </div>
        </div>
    </div>
</div>


<!-- 강의실 나가기 Modal-->
<form id="leaveForm" th:action="@{'/memberlroom/delete/' + ${lectureRoom.lectureRoomId} + '/' + ${session.member.uniqueId}}" method="post">
    <div class="modal fade" id="lectureRoomOutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">강의실을 나가겠습니까?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">해당 강의실을 나가게 될 경우 강의실 내 정보와 공지를 확인할 수 없습니다.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
                    <button class="btn btn-primary" type="submit">나가기</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Create Post Modal -->
<div class="modal fade" id="CreatePostModal" tabindex="-1" aria-labelledby="CreateModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 60%; max-width: 800px; height: 50%; max-height: 400px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="CreateModalLabel">게시물 생성</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="createPostForm" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="modalPostTitle">게시물 제목:</label>
                        <input type="text" id="modalPostTitle" name="postTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="modalPostContent">게시물 내용:</label>
                        <textarea id="modalPostContent" name="postContent" class="form-control" rows="5"></textarea>
                    </div>
                    <label for="modalFile">파일 업로드:</label>
                    <input type="file" id="modalFile" name="file">
                    <input type="hidden" id="modalLRoomId" name="lRoomId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button id="openModalButton" class="btn btn-primary">게시물 생성</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="PostHeaderModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>
<!-- Post Update Modal-->
<div class="modal fade" id="PostUpdateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">공지 수정</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="postTitle">게시물 제목:</label>
                    <input type="text" id="postTitle" class="form-control">
                </div>
                <div class="form-group">
                    <label for="postContent">게시물 내용:</label>
                    <textarea id="postContent" class="form-control" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label for="postContent">연결된 태그</label>
                    <small id="postTag" class="text-muted"></small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmUpdate" class="btn btn-primary" style="background: #2e59d9; border-color: #2e59d9;" onclick="updateSelectedPost()">수정</button>
                <button class="btn btn-primary" data-dismiss="modal" style="background: #adb5bd; border-color: #adb5bd;">취소</button>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    var updatePostId;
    function setUpdatePostId(postId, postTitle, postContent, tag) {
        console.log("tag", tag);
        $('#postTitle').val(postTitle);
        $('#postContent').val(postContent);
        if(tag) {
            $('#postTag').text(tag);
        } else {
            $('#postTag').text('없음');
        }
        updatePostId = postId;
    }
    function updatePost(postId) {
        var postData = {
            postTitle: $("#postTitle").val(),
            postContent: $("#postContent").val()
            // 필요한 경우 다른 필드 추가
        };
        $.ajax({
            type: "POST",
            url: "/ClassHub/post/updateForm/" + postId,
            contentType: "application/json",
            data: JSON.stringify(postData),
            success: function(response) {
                console.log("공지가 성공적으로 수정되었습니다.");
                location.reload();
            },
            error: function(xhr, status, error) {
                console.error("공지 수정 중 에러가 발생했습니다:", error);
            }
        });
    }

    function updateSelectedPost() {
        console.log("post 아이디: ", updatePostId);
        updatePost(updatePostId); // deleteTag 함수 호출
    }
</script>

<!-- Post Delete Modal-->
<div class="modal fade" id="PostDeleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">공지 삭제</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <h4>해당 공지를 정말 삭제하시겠습니까?</h4>
                <p>공지 삭제 시 연결된 태그도 함께 삭제됩니다.</p>
                <p>삭제하시면 더 이상 해당 공지 정보를 확인하실 수 없습니다.</p>
            </div>
            <div class="modal-footer">
                <button id="confirmDelete" class="btn btn-primary" style="background: #2e59d9; border-color: #2e59d9;" onclick="deleteSelectedPost()">삭제</button>
                <button class="btn btn-primary" data-dismiss="modal" style="background: #adb5bd; border-color: #adb5bd;">취소</button>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    var deletePostId;
    function setDeletePostId(postId) {
        deletePostId = postId;
    }// 태그 삭제 함수
    function deletePost(postId) {
        $.ajax({
            type: "POST",
            url: "/ClassHub/post/delete/" + postId,
            success: function(response) {
                console.log("공지가 성공적으로 삭제되었습니다.");
                location.reload();
            },
            error: function(xhr, status, error) {
                console.error("공지 삭제 중 에러가 발생했습니다:", error);
            }
        });
    }

    function deleteSelectedPost() {
        console.log("post 아이디: ", deletePostId);
        deletePost(deletePostId); // deleteTag 함수 호출
    }
</script>
<!-- Add this script block -->
<script>
    $(document).ready(function() {
        // Show the first modal when the create post button is clicked
        $('#createPostButton').click(function() {
            let lRoomId = $(this).data('lroom-id');
            $('#modalLRoomId').val(lRoomId);
            $('#CreatePostModal').modal('show');
        });

        // Function to hide the first modal and open the second modal
        $('#openModalButton').click(function(event) {
            event.preventDefault();
            submitPostFormAndLoadModal(); // Submit the form and load the second modal
        });
    });

    function loadHeadersIntoModal() {
        $.ajax({
            url: '/ClassHub/post/postModal',
            type: 'GET',
            cache: false,
            success: function(response) {
                $('#PostHeaderModal .modal-content').html(response);
                $('#PostHeaderModal').modal('show');
            },
            error: function() {
                alert("Error loading the modal content");
            }
        });
    }

    function submitPostFormAndLoadModal() {
        var formData = new FormData($('#createPostForm')[0]);
        var lRoomId = $('#createPostButton').data('lroom-id');

        // Hide the first modal before showing the second one
        $('#CreatePostModal').modal('hide');

        $.ajax({
            url: '/ClassHub/post/postForm',
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            statusCode: {
                200: function(response) {
                    loadHeadersIntoModal(response);
                },
                204: function() {
                    window.location.href = '/ClassHub/lecture-room/detail/' + lRoomId;
                }
            },
            error: function() {
                alert("파일 업로드에 실패했습니다.");
            }
        });
    }
</script>
</body>
</html>
